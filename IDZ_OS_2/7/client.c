#include <fcntl.h>#include <semaphore.h>#include <stdbool.h>#include <stdio.h>#include <stdlib.h>#include <sys/mman.h>#include <sys/types.h>#include <unistd.h>#define SINGLE_ROOMS 10#define DOUBLE_ROOMS 15#define TOTAL_ROOMS (SINGLE_ROOMS + DOUBLE_ROOMS)typedef struct {  int single_rooms;  int double_rooms;  int single_occupants;  int double_occupants;} hotel_status;void customer(bool is_male) {  sem_t *sem_single = sem_open("sem_single", 0);  sem_t *sem_double = sem_open("sem_double", 0);  sem_t *sem_mutex = sem_open("sem_mutex", 0);  int shm_fd = shm_open("hotel_shm", O_RDWR, 0666);  if (shm_fd == -1) {    perror("shm_open");    exit(1);  }  hotel_status *hotel =      (hotel_status *)mmap(NULL, sizeof(hotel_status), PROT_READ | PROT_WRITE,                           MAP_SHARED, shm_fd, 0);  if (hotel == MAP_FAILED) {    perror("mmap");    exit(1);  }  close(shm_fd);  while (1) {    usleep(rand() % 2000000 + 500000);    if (is_male) {      if (sem_trywait(sem_single) == 0) {        sem_wait(sem_mutex);        hotel->single_rooms--;        hotel->single_occupants++;        printf("Мужчина заселяется в одноместный номер. Оставшиеся номера: %d "               "одноместных, %d двухместных\n",               hotel->single_rooms, hotel->double_rooms);        sem_post(sem_mutex);        usleep(rand() % 2000000 + 500000);        sem_wait(sem_mutex);        hotel->single_rooms++;        hotel->single_occupants--;        printf("Мужчина освобождает одноместный номер.\n");        sem_post(sem_mutex);        sem_post(sem_single);      } else if (sem_trywait(sem_double) == 0) {        sem_wait(sem_mutex);        hotel->double_rooms--;        hotel->double_occupants++;        printf("Мужчина заселяется в двухместный номер. Оставшиеся номера: %d "               "одноместных, %d двухместных\n",               hotel->single_rooms, hotel->double_rooms);        sem_post(sem_mutex);        usleep(rand() % 2000000 + 500000);        sem_wait(sem_mutex);        hotel->double_rooms++;        hotel->double_occupants--;        printf("Мужчина освобождает двухместный номер.\n");        sem_post(sem_mutex);        sem_post(sem_double);      } else {        printf("Мужчина уходит, нет свободных номеров.\n");      }    } else {      if (sem_trywait(sem_double) == 0) {        sem_wait(sem_mutex);        hotel->double_rooms--;        hotel->double_occupants++;        printf("Женщина заселяется в двухместный номер. Оставшиеся номера: %d "               "одноместных, %d двухместных\n",               hotel->single_rooms, hotel->double_rooms);        sem_post(sem_mutex);        usleep(rand() % 2000000 + 500000);        sem_wait(sem_mutex);        hotel->double_rooms++;        hotel->double_occupants--;        printf("Женщина освобождает двухместный номер.\n");        sem_post(sem_mutex);        sem_post(sem_double);      } else {        printf("Женщина уходит, нет свободных номеров.\n");      }    }  }}int main(int argc, char *argv[]) {  if (argc != 2) {    fprintf(stderr, "Usage: %s <is_male (0 or 1)>\n", argv[0]);    exit(1);  }  bool is_male = atoi(argv[1]) == 1;  srand(getpid());  customer(is_male);  return 0;}